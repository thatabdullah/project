name: deploy

on:
    push:
        branches:
            'main'

jobs:
    runner:
        runs-on: self-hosted
        strategy:
            matrix:
                http: ["10.0.2.150","10.0.2.149"]
        steps:
            - name: deploying app on http server
              env:
                SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
              run: |
                echo "$SSH_PRIVATE_KEY" > ~/.ssh/capstonekey
                chmod 600 ~/.ssh/capstonekey
                ssh -i ~/.ssh/capstonekey root@${{matrix.http}} "echo "hello http" "
                
            ##" cd /project && docker image pull ithatabdullah/project:latest && docker compose -f Docker-compose.yml run -d --no-deps app  && docker image prune -a --filter "until=168h" && y"


                    